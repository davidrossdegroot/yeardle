<% content_for :title, "Game Results - Yeardle" %>

<div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
  <div class="text-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-2">Game Results</h1>
  </div>

  <div class="bg-blue-50 rounded-lg p-4 mb-6">
    <h2 class="text-lg font-semibold text-blue-800 mb-2">Event</h2>
    <p class="text-blue-700 font-medium"><%= @game.event.name %></p>
    <p class="text-blue-600 text-sm mt-1"><%= @game.event.description %></p>
    <div class="flex items-center justify-between mt-3">
      <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
        <%= @game.event.category %>
      </span>
      <span class="text-blue-800 font-bold">Year: <%= @game.event.year %></span>
    </div>
  </div>

  <% if @game.won? %>
    <div class="bg-green-50 rounded-lg p-4 mb-6">
      <h2 class="text-xl font-semibold text-green-800 text-center">🎉 You Won!</h2>
      <p class="text-green-700 text-center">Completed in <%= @game.guesses.count %> guess<%= 'es' unless @game.guesses.count == 1 %>!</p>
    </div>
  <% else %>
    <div class="bg-red-50 rounded-lg p-4 mb-6">
      <h2 class="text-xl font-semibold text-red-800 text-center">😔 Game Over</h2>
      <p class="text-red-700 text-center">Better luck next time!</p>
      <p class="text-red-700 text-center">The correct answer was <%= @game.event.year %>.</p>
    </div>
  <% end %>

  <div class="mb-6">
    <h3 class="text-lg font-semibold text-gray-700 mb-3">Your Guesses</h3>
    <div class="space-y-2">
      <% @game.guesses.order(:created_at).each_with_index do |guess, index| %>
        <div class="flex items-center justify-between bg-gray-50 rounded-lg p-3">
          <div>
            <span class="text-sm text-gray-500">Guess <%= index + 1 %></span>
            <span class="font-medium text-gray-800 ml-2"><%= guess.year %></span>
          </div>
          <div class="text-right">
            <span class="text-sm font-medium 
              <%= 'text-green-600' if guess.correct? %>
              <%= 'text-red-600' unless guess.correct? %>">
              <%= guess.feedback %>
            </span>
            <% unless guess.correct? %>
              <p class="text-xs text-gray-500">
                <%= guess.difference %> years off
              </p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="text-center space-x-4">
    <%= link_to "Play Again", games_path, 
          class: "bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700 inline-block font-medium" %>
    <%= link_to "Share Result", "#", 
          class: "bg-gray-600 text-white py-2 px-6 rounded-md hover:bg-gray-700 inline-block font-medium",
          onclick: "shareResult(); return false;" %>
  </div>
</div>

<script>
function shareResult() {
  const gameWon = <%= @game.won? ? 'true' : 'false' %>;
  const guessCount = <%= @game.guesses.count %>;
  const eventName = "<%= j @game.event.name %>";
  const eventYear = <%= @game.event.year %>;
  
  let result = `Yeardle - ${eventName} (${eventYear})\n\n`;
  
  if (gameWon) {
    result += `🎉 Solved in ${guessCount}/6 guesses!\n\n`;
  } else {
    result += `😔 Failed to guess in 6 attempts\n\n`;
  }
  
  <% @game.guesses.order(:created_at).each_with_index do |guess, index| %>
    <% if guess.correct? %>
      result += '🟩 ';
    <% elsif guess.difference <= 5 %>
      result += '🟨 ';
    <% elsif guess.difference <= 25 %>
      result += '🟧 ';
    <% else %>
      result += '🟥 ';
    <% end %>
  <% end %>
  
  result += '\n\nPlay Yeardle at: ' + window.location.origin;
  
  if (navigator.share) {
    navigator.share({
      title: 'My Yeardle Result',
      text: result
    });
  } else {
    navigator.clipboard.writeText(result).then(() => {
      alert('Result copied to clipboard!');
    });
  }
}
</script>
